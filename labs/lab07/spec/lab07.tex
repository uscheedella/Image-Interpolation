
\documentclass[letter]{article}
\include{rhewett_style}
\usepackage[margin=1in]{geometry}

\graphicspath{{./figures/}}

\usepackage{ulem} % Make \emph use underline and not italics

\renewcommand{\familydefault}{\sfdefault}

\newcommand{\coursenumber}{CMDA 3634}
\newcommand{\coursecrn}{Hewett}

\newcommand{\assignmenttype}{Lab}
\newcommand{\assignmentnumber}{07}

\newcommand{\assignmentreleasedate}{2019-03-05 10:00:00}
\newcommand{\assignmentduedate}{2019-03-07 23:59:00}

\newcommand{\assignmenttitle}{OpenMP and Scalability}

\newcommand{\mypath}[1]{\texttt{\path{#1}}}
\newcommand{\cmd}[1]{\begin{quote}\texttt{> #1}\end{quote}}

\title{\coursenumber \coursecrn}
\date{}


\pagestyle{fancy}
\fancyhf{}
\lhead{CMDA 3634 SP2019}
\chead{\assignmenttitle}
\rhead{\assignmenttype~\assignmentnumber}
\renewcommand{\footrulewidth}{0.4pt}% default is 0pt; adds rule for footer
\lfoot{Assigned: \assignmentreleasedate}
\cfoot{\thepage}
\rfoot{Due: \assignmentduedate}



\begin{document}

% \maketitle
\thispagestyle{fancy}% Fix pagestyle to put the header and footer back

\begin{itemize}[leftmargin=*]
    \item[] \textbf{\assignmenttype~\assignmentnumber}: \assignmenttitle
    \item[] \textbf{Assigned: } \assignmentreleasedate
    \item[] \textbf{Due: } \assignmentduedate
    \item[] \textbf{Instructions: }
        \begin{itemize}
            \item Written portions of this assignment are submitted via Canvas.  Unless specified otherwise, the written portion of the assignment is to be completed using LaTeX.  All derivations, images, graphs, and tables are to be included in this document.  Handwritten solutions will receive zero credit.
            \item Code portions of this assignment are submitted via \texttt{code.vt.edu}.  Source code must be in the private repository, to which the CMDA 3634 instructors must have access.
        \end{itemize}
    \item[] \textbf{Deliverables:} For this assignment, you are to submit the following:
        \begin{enumerate}
            \item (Canvas) \texttt{<pid>\_\assignmenttype\_07.pdf}: A PDF file, renderd by \texttt{pdflatex} (the file generated by Overleaf is sufficient) containing the answers to the questions requiring written answers.  Use the template provided in the project repository. 
            \item (\texttt{code.vt.edu}) The source files required to compile and run your solutions to the lab and the tex and image files for your report, in the appropriate directories.
        \end{enumerate}
    \item[] \textbf{Collaboration: } This assignment is to be completed by yourself, however, you make seek assistance from your classmates.  In your submission you must indicate from whom you received assistance.
    \item[] \textbf{Honor Code: } By submitting this assignment, you acknowledge that you have adhered to the Virginia Tech Honor Code and attest to the following:
        \begin{quote}
           I have neither given nor received unauthorized assistance on this assignment.  The work I am presenting is ultimately my own.
        \end{quote}
\end{itemize}

\hrule

\pagebreak

\section*{Resources}

\begin{itemize}

    \item OpenMP:
        \begin{itemize}
            \item Reference Book \url{https://mitpress.mit.edu/books/using-openmp}
            \item General tutorial  \url{https://computing.llnl.gov/tutorials/openMP/}
            \item Timing  \url{https://gcc.gnu.org/onlinedocs/gcc-4.5.0/libgomp/omp_005fget_005fwtime.html}
        \end{itemize}
\end{itemize}

\section*{Task}
In this lab you will use OpenMP to parallelize the basic linear algebra tools we have developed in the labs so far.  Once you have parallelized the routines, you will perform strong and weak scalability studies and evaluate if you are obtaining the expected speedups.

You will perform your studies on Cascades, but you should perform the initial developments in your VM.

\begin{enumerate}

    \item \textbf{Setup} your coding environment.
        \begin{enumerate}
            \item Pull the lab materials from the upstream repository.
        \end{enumerate}

    \item \textbf{Implement} the following requirements in C.  Be sure to use git to commit your code regularly.  Push early, push often!
        \begin{enumerate}
            \item First look at the \texttt{readme} to understand what files and scripts are available.  Read the entire assignment.
            \item Use OpenMP to parallelize the following routines in \mypath{vector.c}:
                \begin{itemize}
                    \item \texttt{norm()}
                    \item \texttt{normalize()}
                    \item \texttt{axpy()}
                    \item \texttt{inner\_product()}
                \end{itemize}
                \emph{You must specify all private or shared variables.  A simple parallel for is insufficient and will not receive full credit.}
            \item Use OpenMP to parallelize the following routines in \mypath{matrix.c}:
                \begin{itemize}
                    \item \texttt{matvec()}
                    \item \texttt{matvec\_triangular()}
                    \item \texttt{matvec\_triangular\_guided()}
                \end{itemize}
                \emph{You must specify all private or shared variables.  A simple parallel for is insufficient and will not receive full credit.}

            The routine \texttt{matvec\_triangular()} performs a matrix-vector product with an matrix $\mat{A}$ that is \textit{lower triangular}.  In this routine, use OpenMP as you usually would.  You will see that you observe poor scalability.  In \texttt{matvec\_triangular\_guided()}, use guided scheduling to improve the scalability.
            \item Use the provided experiment script \mypath{time_vector.sh} to conduct strong and weak scalability studies for these vector operations for 1-8 OpenMP threads.  Use the provided experiment script \mypath{time_matrix.sh} to conduct strong and weak scalability studies for these matrix operations for 1-8 OpenMP threads.
            \item An sbatch submission script has been provided to assist in running your experiments on Cascades.
            \item Push your work to \texttt{code.vt.edu}. \texttt{ssh} into Cascades and clone your code. Submit the bash script as a job using \texttt{sbatch}. Then use \texttt{scp} to copy the results back to your laptop and use the data to answer the questions.  
        \end{enumerate}
            
    \item \textbf{Answer} the questions listed below.  You may use Overleaf, but your tex source must be committed to the \mypath{reports/} directory.

    \item \textbf{Submit} your results.
        \begin{enumerate}
            \item After you have completed this lab (which we'll continue in class on Thursday), upload a PDF of your report to Canvas.
            \item Push your source code and latex files to \texttt{code.vt.edu}.
            \item Examine your assignment repository on \url{code.vt.edu} to be sure that all of your materials have been correctly submitted.
        \end{enumerate}
   
\end{enumerate}

\pagebreak
\section*{Questions}

    Answer the following questions.  No template is provided (you may copy one from a previous week if you like).  Place a copy of your report in the \mypath{reports/} directory.

    \begin{enumerate}
        \item For each routine you parallelized, give the complete OpenMP pragma you used.  Use a listings block to typeset the code.
            \begin{itemize}
                \item \texttt{norm()}
                \item \texttt{normalize()}
                \item \texttt{axpy()}
                \item \texttt{inner\_product()}
                \item \texttt{matvec()}
                \item \texttt{matvec\_triangular()}
                \item \texttt{matvec\_triangular\_guided()}
            \end{itemize}

        \item For the vector operations, create one plot showing the speedup in the strong scalability study and one plot showing the speedup in the weak scalability study.  Which operations show good strong scalability?  Which operations show good weak scalability?  Why do you think this is the case?

        You plots must be correctly labeled and have a legend.  The y-axis should be speedup and the x-axis should be the number of processors.

        \item For the matrix operations, create one plot showing the speedup in the strong scalability study and one plot showing the speedup in the weak scalability study.  Which operations show good strong scalability?  Which operations show good weak scalability?  Why do you think this is the case?

        You plots must be correctly labeled and have a legend.  The y-axis should be speedup and the x-axis should be the number of processors.

        \item Why did you observe poor scalability for \texttt{matvec\_triangular()}?  Why did you get better scalability with \texttt{matvec\_triangular\_guided()}?
        
        \item Other than the instructor or TAs, who did to assist or receive assistance from on this assignment?

    \end{enumerate}

\end{document}